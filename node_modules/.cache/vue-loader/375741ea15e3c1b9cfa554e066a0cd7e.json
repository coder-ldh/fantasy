{"remainingRequest":"/Users/wenjian/Desktop/github/fantasy/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wenjian/Desktop/github/fantasy/src/components/movieIndex/cityList/index.vue?vue&type=style&index=0&id=b9f9148e&lang=scss&scoped=true&","dependencies":[{"path":"/Users/wenjian/Desktop/github/fantasy/src/components/movieIndex/cityList/index.vue","mtime":1590030339989},{"path":"/Users/wenjian/Desktop/github/fantasy/node_modules/css-loader/index.js","mtime":1590023966683},{"path":"/Users/wenjian/Desktop/github/fantasy/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":1590023615263},{"path":"/Users/wenjian/Desktop/github/fantasy/node_modules/postcss-loader/src/index.js","mtime":1590023615114},{"path":"/Users/wenjian/Desktop/github/fantasy/node_modules/sass-loader/dist/cjs.js","mtime":1590023967846},{"path":"/Users/wenjian/Desktop/github/fantasy/node_modules/cache-loader/dist/cjs.js","mtime":1590023966642},{"path":"/Users/wenjian/Desktop/github/fantasy/node_modules/vue-loader/lib/index.js","mtime":1590023615263}],"contextDependencies":[],"result":["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n.clearfix {\n  overflow: hidden;\n}\n.city_body {\n  margin-top: 80px;\n  margin-bottom: 60px;\n  display: flex;\n  width: 100%;\n  position: absolute;\n  top: 0;\n  bottom: 0;\n}\n.city_body .city_list {\n  flex: 1;\n  width: 100%;\n  overflow: auto;\n  background: #fff;\n}\n.city_body .city_list::-webkit-scrollbar {\n  background-color: transparent;\n  width: 0;\n}\n.city_body .city_hot {\n  margin-top: 20px;\n}\n.city_body .city_hot h2 {\n  padding-left: 15px;\n  line-height: 30px;\n  font-size: 14px;\n  background: #f0f0f0;\n  font-weight: normal;\n}\n\n.city_body .city_hot ul li {\n  float: left;\n  background: #fff;\n  width: 29%;\n  height: 33px;\n  margin-top: 15px;\n  margin-left: 3%;\n  padding: 0 4px;\n  border: 1px solid #e6e6e6;\n  border-radius: 3px;\n  line-height: 33px;\n  text-align: center;\n  box-sizing: border-box;\n}\n.city_body .city_sort div {\n  margin-top: 20px;\n}\n.city_body .city_sort h2 {\n  padding-left: 15px;\n  line-height: 30px;\n  font-size: 14px;\n  background: #f0f0f0;\n  font-weight: normal;\n}\n.city_body .city_sort ul {\n  padding-left: 10px;\n  margin-top: 10px;\n}\n.city_body .city_sort ul li {\n  line-height: 30px;\n  line-height: 30px;\n}\n.city_body .city_index {\n  width: 20px;\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n  text-align: center;\n  border-left: 1px #e6e6e6 solid;\n  li {\n    margin: 7px 0;\n  }\n}\n",{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAkLA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/components/movieIndex/cityList","sourcesContent":["<template>\n  <div class=\"city_body\">\n    <div class=\"city_list\">\n      <loading v-if=\"isLoading\"></loading>\n      <scroller ref=\"jump\" v-else>\n        <!-- 由于下面有两个部分，所以补一个div -->\n        <div>\n          <div class=\"city_hot\">\n            <h2>热门城市</h2>\n            <ul class=\"clearfix\">\n              <!-- tap点击事件处理城市信息 -->\n              <li\n                v-for=\"item in hostCity\"\n                :key=\"item.id\"\n                @tap=\"changCity(item.nm,item.id)\"\n              >{{ item.nm }}</li>\n            </ul>\n          </div>\n          <div class=\"city_sort\" ref=\"city_sort\">\n            <div v-for=\"item in cityData\" :key=\"item.id\">\n              <h2>{{ item.index }}</h2>\n              <ul>\n                <li\n                  v-for=\" list  in item.list\"\n                  :key=\"list.id\"\n                  @tap=\"changCity(list.nm,list.id)\"\n                >{{ list.nm }}</li>\n              </ul>\n            </div>\n          </div>\n        </div>\n      </scroller>\n    </div>\n    <div class=\"city_index\">\n      <ul>\n        <li\n          v-for=\"(item,index) in cityData\"\n          :key=\"item.id\"\n          @click=\"toTarget(index)\"\n        >{{ item.index }}</li>\n      </ul>\n    </div>\n  </div>\n</template>\n\n<script>\nexport default {\n  name: \"cityList\",\n  data: function() {\n    return {\n      cityData: [],\n      hostCity: [],\n      isLoading: true\n    };\n  },\n  mounted() {\n    // 获取本次存储\n    let cityData = window.localStorage.getItem(\"cityList\");\n    let hostCity = window.localStorage.getItem(\"hostCity\");\n    // 判断本地存储是否存在，存在就不发送ajax请求\n    if (cityData && hostCity) {\n      this.cityData = JSON.parse(cityData);\n      this.hostCity = JSON.parse(hostCity);\n      this.isLoading = false;\n    } else {\n      // 获取数据\n      this.axios.get(\"/api/cityList\").then(res => {\n        // console.log(res.data.data)\n        if (res.status === 200) {\n          var data = res.data.data.cities;\n          // 对数据进行处理\n          this.cityData = this.formatCityList(data);\n          this.hostCity = this.chooseHotCity(data);\n          // 将数据进行本地存储\n          window.localStorage.setItem(\n            \"cityList\",\n            JSON.stringify(this.formatCityList(data))\n          );\n          window.localStorage.setItem(\n            \"hostCity\",\n            JSON.stringify(this.chooseHotCity(data))\n          );\n\n          // 数据处理成功之后，将isLoading 变成false\n          this.isLoading = false;\n        }\n      });\n    }\n  },\n  methods: {\n    // 对单词首字母进行\n    formatCityList(cities) {\n      // 检查数据是否传入\n      // console.log(cities)\n      // 这里可以作出一个判断？ 判断数据是否正确传入\n      var cityList = [];\n      // var hostList = [];\n      // 循环遍历传递过来的数据\n      for (var i = 0; i < cities.length; i++) {\n        // 取出数组中每个单词的字母\n        var firstLetter = cities[i].py.substring(0, 1).toUpperCase();\n        if (toCom()) {\n          cityList.push({\n            index: firstLetter,\n            list: [{ nm: cities[i].nm, id: cities[i].id }]\n          });\n        } else {\n          // 累加到已有索引\n          for (var j = 0; j < cityList.length; j++) {\n            if (cityList[j].index === firstLetter) {\n              cityList[j].list.push({ nm: cities[i].nm, id: cities[i].id });\n            }\n          }\n        }\n      }\n      // 处理排序\n      cityList.sort(function(a, b) {\n        if (a.index > b.index) {\n          return 1;\n        } else if (a.index < b.index) {\n          return -1;\n        } else {\n          return 0;\n        }\n      });\n\n      //在写一个判断的函数\n      function toCom() {\n        for (var i = 0; i < cityList.length; i++) {\n          if (cityList[i].index === firstLetter) {\n            return false;\n          }\n        }\n        return true;\n      }\n      // console.log(cityList)\n      return cityList;\n    },\n    // 选出热门城市\n    chooseHotCity(cities) {\n      let hostCity = [];\n      for (var i = 0; i < cities.length; i++) {\n        if (cities[i].isHot === 1) {\n          hostCity.push(cities[i]);\n        }\n      }\n      return hostCity;\n    },\n    // 点击字母进行跳转\n    toTarget(index) {\n      // console.log(index)\n      // 处理dom\n      let h2 = this.$refs.city_sort.getElementsByTagName(\"h2\");\n      // console.log(h2)\n      // console.log(this.$refs.city_sort.parentNode.scrollTop)\n      // 给父级的scrollTop 设置为 当前h2的卷曲出去的高度\n      // this.$refs.city_sort.parentNode.scrollTop = h2[index].offsetTop;\n      // this.$refs.jump.jump(-h2[index].offsetTop);\n      // 调用了组件中的方法  使用ref标记\n      // 注意：将ref放在组件上，则this.$refs.组件名可以拿到组件的对象，拿到组件对象就可以调用组件对象中的方法\n      this.$refs.jump.jump(-h2[index].offsetTop);\n    },\n    // 点击改变城市city\n    changCity(nm, id) {\n      // console.log(nm, id)\n      // 调用vuex中的mutations中的方法进行处理  ok\n      this.$store.commit(\"city/CITY_INFO\", { nm, id });\n      // 为了返回时，城市数据不再该改变。将数据本地化处理\n      window.localStorage.setItem(\"city_nm\", nm);\n      window.localStorage.setItem(\"city_id\", id);\n      // 编程式导航\n      this.$router.push(\"/movie/nowPlaying\");\n    }\n  }\n};\n</script>\n\n<style lang=\"scss\" scoped>\n.clearfix {\n  overflow: hidden;\n}\n.city_body {\n  margin-top: 80px;\n  margin-bottom: 60px;\n  display: flex;\n  width: 100%;\n  position: absolute;\n  top: 0;\n  bottom: 0;\n}\n.city_body .city_list {\n  flex: 1;\n  width: 100%;\n  overflow: auto;\n  background: #fff;\n}\n.city_body .city_list::-webkit-scrollbar {\n  background-color: transparent;\n  width: 0;\n}\n.city_body .city_hot {\n  margin-top: 20px;\n}\n.city_body .city_hot h2 {\n  padding-left: 15px;\n  line-height: 30px;\n  font-size: 14px;\n  background: #f0f0f0;\n  font-weight: normal;\n}\n\n.city_body .city_hot ul li {\n  float: left;\n  background: #fff;\n  width: 29%;\n  height: 33px;\n  margin-top: 15px;\n  margin-left: 3%;\n  padding: 0 4px;\n  border: 1px solid #e6e6e6;\n  border-radius: 3px;\n  line-height: 33px;\n  text-align: center;\n  box-sizing: border-box;\n}\n.city_body .city_sort div {\n  margin-top: 20px;\n}\n.city_body .city_sort h2 {\n  padding-left: 15px;\n  line-height: 30px;\n  font-size: 14px;\n  background: #f0f0f0;\n  font-weight: normal;\n}\n.city_body .city_sort ul {\n  padding-left: 10px;\n  margin-top: 10px;\n}\n.city_body .city_sort ul li {\n  line-height: 30px;\n  line-height: 30px;\n}\n.city_body .city_index {\n  width: 20px;\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n  text-align: center;\n  border-left: 1px #e6e6e6 solid;\n  li {\n    margin: 7px 0;\n  }\n}\n</style>\n"]}]}